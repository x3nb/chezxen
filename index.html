<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Punky Community</title>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Vast+Shadow&display=swap" rel="stylesheet" />
<!-- Supabase CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  body {
    margin: 0;
    padding: 0;
    background: #000;
    font-family: 'Press Start 2P', cursive;
    color: white;
    overflow: hidden;
  }

  .background-shapes {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .shape {
    position: absolute;
    border-radius: 50%;
    animation: float 10s infinite linear;
  }

  @keyframes float {
    0% { transform: translateY(0) rotate(0deg); }
    100% { transform: translateY(-100vh) rotate(360deg); }
  }

  .container {
    position: relative;
    z-index: 1;
    text-align: center;
    padding: 20px;
  }

  #user-avatar {
    width: 100px;
    height: 100px;
    margin: 20px auto;
  }
#avatar-title {
  color: #f0f;          /* Pink color */
  font-size: 1.2em;     /* Slightly bigger */
  margin-top: 10px;     /* Space below avatar */
  text-shadow: 2px 2px #000;  /* Subtle shadow for depth */
}
  #auth-buttons button {
    margin: 10px;
    padding: 10px 20px;
    background: #f0f;
    color: white;
    border: none;
    cursor: pointer;
    font-family: 'Press Start 2P', cursive;
  }

  .paper {
    background: rgba(0,0,0,0.8);
    border: 2px solid #f0f;
    padding: 20px;
    margin: 20px auto;
    max-width: 400px;
  }

  .chat-header {
    font-size: 1.2em;
    margin-bottom: 10px;
  }

  .loading {
    color: #0ff;
  }

  .greet {
    margin: 20px 0;
  }

  .menu {
    display: flex;
    justify-content: space-around;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  .menu-item {
    cursor: pointer;
    padding: 10px;
    background: #ff0;
    color: black;
    border-radius: 5px;
    margin: 5px;
    font-family: 'Press Start 2P', cursive;
  }

  #synopsis {
    margin-top: 20px;
    text-align: left;
  }

  #signup-message {
    color: lime;
    font-weight: bold;
    margin-top: 10px;
  }

  #resend-btn {
    margin-top: 10px;
    padding: 8px 15px;
    background: #0ff;
    color: black;
    border: none;
    cursor: pointer;
    font-family: 'Press Start 2P', cursive;
  }
</style>
</head>
<body>

<!-- Floating shapes background -->
<div class="background-shapes" id="shapes"></div>
<!-- Avatar + Title -->
<div id="user-avatar">
  <img id="avatar-img" src="officialsticker.png" alt="User Avatar" style="width:100px; height:100px; border-radius:50%;" />
  <div id="avatar-title">Punk Zen</div>
</div>

<!-- Auth Buttons -->
<div id="auth-buttons">
  <button onclick="showSignUp()">Sign Up</button>
  <button onclick="showSignIn()">Log In</button>
</div>
  <!-- Auth Form -->
  <div class="paper" id="auth-form" style="display:none;">
    <h2 style="font-family:'Vast Shadow', cursive;">Welcome to the Punk Tribe</h2>
    <input type="email" id="auth-email" placeholder="Email" style="margin:10px; padding:10px; font-family:'Press Start 2P';" /><br>
    <input type="password" id="auth-password" placeholder="Password" style="margin:10px; padding:10px; font-family:'Press Start 2P';" /><br>
    <button onclick="submitAuth()">Submit</button>
    <button onclick="cancelAuth()">Cancel</button>
    <div id="signup-message"></div>
    <button id="resend-btn" style="display:none;" onclick="resendConfirmation()">Resend Confirmation</button>
  </div>

  <!-- Main Content -->
  <div class="paper" id="main-content" style="display:none;">
    <div class="chat-header" id="chat-header">Loading...</div>
    <div class="loading" id="loading-indicator">Connecting to the punk chat...</div>
    <div id="chat" class="greet"></div>
    <div class="menu" id="menu"></div>
    <div id="synopsis"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  // Floating shapes
  const shapeCount = 20;
  const shapesContainer = document.getElementById('shapes');
  for(let i=0;i<shapeCount;i++){
    const shape = document.createElement('div');
    shape.className='shape';
    shape.style.width = (10 + Math.random()*30) + 'px';
    shape.style.height = shape.style.width;
    shape.style.top = Math.random()*100 + '%';
    shape.style.left = Math.random()*100 + '%';
    shape.style.background = `linear-gradient(45deg, #f0f, #0ff, #ff0)`;
    shape.style.transform = `rotate(${Math.random()*360}deg)`;
    shape.style.animationDuration = (10 + Math.random()*20)+'s';
    shapesContainer.appendChild(shape);
  }

  // Initialize Supabase
  const supabaseUrl = ''; // <-- Replace with your URL
  const supabaseKey = ''; // <-- Replace with your anon key
  window.supabase = supabase.createClient(supabaseUrl, supabaseKey);

  window.authMode = null;
  window.currentUser = null;

  const authForm = document.getElementById('auth-form');
  const authButtons = document.getElementById('auth-buttons');
  const signupMsg = document.getElementById('signup-message');
  const resendBtn = document.getElementById('resend-btn');

  // Show Sign Up / Sign In
  window.showSignUp = () => { authMode='signup'; authForm.style.display='block'; authButtons.style.display='none'; signupMsg.innerText=''; resendBtn.style.display='none'; };
  window.showSignIn = () => { authMode='signin'; authForm.style.display='block'; authButtons.style.display='none'; signupMsg.innerText=''; resendBtn.style.display='none'; };
  window.cancelAuth = () => { authMode=null; authForm.style.display='none'; authButtons.style.display='block'; signupMsg.innerText=''; resendBtn.style.display='none'; };

  // Submit Auth
  window.submitAuth = async () => {
    const email = document.getElementById('auth-email').value;
    const password = document.getElementById('auth-password').value;
    if(!email || !password){ alert('Please enter email and password.'); return; }

    if(authMode==='signup'){
      const { data, error } = await supabase.auth.signUp({ email, password });
      if(error){ alert('Sign-up error: '+error.message); return; }
      signupMsg.innerText = `Sign-up successful! Check your email (${email}) to confirm.`;
    }
    else if(authMode==='signin'){
      const { data, error } = await supabase.auth.signInWithPassword({ email, password });
      if(error){
        if(error.message.includes('Email not confirmed')){
          signupMsg.innerText = 'Email not confirmed yet. Please check your inbox.';
          resendBtn.style.display='inline-block';
        } else {
          alert('Login error: '+error.message);
        }
        return;
      } else {
        window.currentUser = data.user;
        authForm.style.display='none';
        authButtons.style.display='none';
        document.getElementById('main-content').style.display='block';
        // Set avatar if exists
        const avatarImg = document.getElementById('avatar-img');
        if(window.currentUser.user_metadata?.avatar_url){ avatarImg.src = window.currentUser.user_metadata.avatar_url; }
        showGreeting();
      }
    }
  };

  // Resend confirmation
  window.resendConfirmation = async () => {
    const email = document.getElementById('auth-email').value;
    if(!email){ alert('Enter your email to resend confirmation'); return; }
    const { data, error } = await supabase.auth.resend({ type: 'signup', email });
    if(error){ alert('Error resending email: '+error.message); return; }
    signupMsg.innerText = 'Confirmation email resent! Check your inbox.';
  };

  // Auto-login if session exists
  const { data: sessionData } = await supabase.auth.getSession();
  if(sessionData.session && sessionData.session.user){
    window.currentUser = sessionData.session.user;
    authForm.style.display='none';
    authButtons.style.display='none';
    document.getElementById('main-content').style.display='block';
    const avatarImg = document.getElementById('avatar-img');
    if(window.currentUser.user_metadata?.avatar_url){ avatarImg.src = window.currentUser.user_metadata.avatar_url; }
    showGreeting();
  }

  // Greeting
  window.showGreeting = () => {
    const header = document.getElementById('chat-header');
    const loading = document.getElementById('loading-indicator');
    header.innerText = `Welcome, ${window.currentUser.email}`;
    loading.style.display='none';
    const chatDiv = document.getElementById('chat');
    chatDiv.innerHTML = `<p>Hello ${window.currentUser.email}! Welcome to your punky community!</p>`;
  };

  // Menu
  const menuItems = [
    { title:'ABOUT', synopsis:'Learn about the punky community and its roots.', link:'https://en.wikipedia.org/wiki/Punk_rock' },
    { title:'MUSIC', synopsis:'Discover punk-inspired tunes and playlists.', link:'https://www.punknews.org/' },
    { title:'SHOP', synopsis:'Get punk fashion and accessories.', link:'https://punkclothing.com/' },
    { title:'BLOG', synopsis:'Read stories and updates from the community.', link:'https://punkblog.com/' }
  ];
  const menuContainer = document.getElementById('menu');
  const synopsisDiv = document.getElementById('synopsis');
  menuItems.forEach(item=>{
    const div = document.createElement('div');
    div.className='menu-item';
    div.innerText=item.title;
    div.onclick=()=>{ synopsisDiv.innerHTML=`<p>${item.synopsis}</p><a href="${item.link}" target="_blank" style="color:#f0f;">Visit Link</a>`; };
    menuContainer.appendChild(div);
  });
});
</script>
</body>
</html>
